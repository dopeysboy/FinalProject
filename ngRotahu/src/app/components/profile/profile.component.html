<div class="row">
  <div class="col-1"></div>
  <div class="col-3">
    <div class="row">
      <app-user-pie-chart></app-user-pie-chart>
      <!-- <p id="initials">{{loggedInUser.firstName.toUpperCase().substring(0,1)}} {{loggedInUser.lastName.toUpperCase().substring(0,1)}}</p> -->
    </div>
    <div *ngIf="!editDebt && !editExpense && !editIncome && !newDebt && !newExpense && !newIncome">
      <div class="row">
        <div class="btn-group" role="group" >
          <button class="btn btn-custom btn-custom-hover col" (click)="setNewDebt()" >Add Debt</button>
          <div ngbDropdown class="d-inline-block btn-group">
            <button type="button" class="btn btn-custom btn-custom-hover" id="debtDropdown" ngbDropdownToggle>Edit Debt</button>
            <div ngbDropdownMenu aria-labelledby="debtDropdown">
              <button ngbDropdownItem *ngFor="let debt of debts" (click)="setEditDebt(debt)">{{debt.name}}</button>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="btn-group" role="group" >
          <button class="btn btn-custom btn-custom-hover col" (click)="setNewExpense()" >Add Expense</button>
          <div ngbDropdown class="d-inline-block btn-group">
            <button type="button" class="btn btn-custom btn-custom-hover" id="expenseDropdown" ngbDropdownToggle>Edit Expense</button>
            <div ngbDropdownMenu aria-labelledby="expenseDropdown">
              <button ngbDropdownItem *ngFor="let expense of expenses" (click)="setEditExpense(expense)">{{expense.description}}</button>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="btn-group" role="group" aria-label="Basic example">
          <button class="btn btn-custom btn-custom-hover col" (click)="setNewIncome()" >Add Income</button>
          <div ngbDropdown class="d-inline-block btn-group">
            <button type="button" class="btn btn-custom btn-custom-hover" id="incomeDropdown" ngbDropdownToggle>Edit Income</button>
            <div ngbDropdownMenu aria-labelledby="incomeDropdown">
              <button ngbDropdownItem *ngFor="let income of incomes" (click)="setEditIncome(income)">{{income.description}}</button>
            </div>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="btn-group" role="group" >
          <button class="btn btn-custom btn-custom-hover col" >Add Resource</button>
          <button class="btn btn-custom btn-custom-hover col" >View Resources</button>
        </div>
      </div>
      <div class="row">
        <button class="btn btn-custom btn-custom-hover " (click)="open(passwordContent)">Change Password</button>
      </div>
      <div class="row">
        <button class="btn btn-custom btn-custom-hover" (click)="open(accountContent)">Update account Information</button>
      </div>
      <div class="row">
        <button class="btn btn-outline-danger" (click)="open(deleteContent)">Delete Account</button>
      </div>
    </div>
    <div *ngIf="editDebt">
      <form>
        <div class="form-row">
          <div class = "form-group">
          <label for="name">Name: </label>
          <input type="text" class="form-control" name="name" [(ngModel)]="editDebt.name" />
        </div>
        <div class="form-group">
          <label for="annualPercentageRate">Annual Percentage Rate: </label>
          <input type="number" class="form-control" name="annualPercentageRate" [(ngModel)]="editDebt.annualPercentageRate" />
        </div>
        <div class="form-group">
          <label for="minimumMonthlyPayment">Minimum Monthly Payment: </label>
          <input type="number" class="form-control" name="minimumMonthlyPayment" [(ngModel)]="editDebt.minimumMonthlyPayment" />
        </div>
        <div class="form-group">
          <label for="currentBalance">Current Balance: </label>
          <input type="number" class="form-control" name="currentBalance" [(ngModel)]="editDebt.currentBalance" />
        </div>
        <div class="form-group">
          <div class="btn-group" role="group" >
            <button class="btn btn-custom cancel-hover" (click)="showMainOptions()">Cancel</button>
            <button class="btn btn-custom send-hover" (click)="updateDebt(editDebt)">Update</button>
            <button class="btn btn-custom delete-hover" (click)="deleteDebt(editDebt)">Delete</button>
          </div>
          </div>
        </div>
      </form>
    </div>
    <div *ngIf="editExpense">
      <form>
        <div class="form-row">
          <div class = "form-group">
          <label for="amount">Amount: </label>
          <input type="number" class="form-control"  name="amount" [(ngModel)]="editExpense.amount" />
        </div>
        <div class="form-group">
          <label for="description">Description: </label>
          <input type="text" name="description" class="form-control"  [(ngModel)]="editExpense.description" />
        </div>
        <div class="form-group">
          <label for="category">Category: </label>
          <input type="text" name="category" class="form-control"  [(ngModel)]="editExpense.category.name" />
        </div>
        <div class="form-group">
          <label for="frequency">Frequency: </label>
          <input type="text" class="form-control" name="frequency" [(ngModel)]="editExpense.frequency.name" />
        </div>
      </div>
        <div class="form-group">
          <div class="btn-group" role="group" >
            <button class="btn btn-custom cancel-hover" (click)="showMainOptions()">Cancel</button>
            <button class="btn btn-custom send-hover" (click)="updateExpense(editExpense)">Update</button>
            <button class="btn btn-custom delete-hover" (click)="deleteExpense(editExpense)">Delete</button>
          </div>
        </div>
      </form>
    </div>
    <div *ngIf="editIncome">
      <form>
        <div class="form-row">
          <div class = "form-group">
          <label for="amount">Amount: </label>
          <input type="number" class="form-control" name="amount" [(ngModel)]="editIncome.amount" />
        </div>
        <div class="form-group">
          <label for="description">Description: </label>
          <input type="text" class="form-control" name="description" [(ngModel)]="editIncome.description" />
        </div>
        <div class="form-group">
          <label for="category">Category: </label>
          <input type="text" class="form-control" name="category" [(ngModel)]="editIncome.category.name" />
        </div>
        <div class="form-group">
          <label for="frequency">Frequency: </label>
          <input type="text" class="form-control" name="frequency" [(ngModel)]="editIncome.frequency.name" />
        </div>
        <div class="form-group">
          <div class="btn-group" role="group" >
            <button class="btn btn-custom cancel-hover" (click)="showMainOptions()">Cancel</button>
            <button class="btn btn-custom send-hover" (click)="updateIncome(editIncome)">Update</button>
            <button class="btn btn-custom delete-hover" (click)="deleteIncome(editIncome)">Delete</button>
          </div>
        </div>
        </div>
      </form>
    </div>
    <div *ngIf="newDebt">
      <form>
        <div class="form-row">
          <div class = "form-group">
          <label for="name">Name</label>
          <input type="text" class="form-control" name = "name" placeholder="Name" [(ngModel)]="newDebt.name">
        </div>
        </div>
        <div class="form-group">
          <label  for="lender">Lender </label>
          <select name = "debtLender" class="form-control" [(ngModel)]="newDebtLender.id">
            <option *ngFor="let lender of lenders" value="{{lender.id}}" >{{lender.name}}</option>
          </select>
        </div>
        <div class="form-group">
          <label  for="debtType">Debt Type </label>
          <select name = "debtType" class="form-control" [(ngModel)]="newDebtType.id">
            <option *ngFor="let type of types" value="{{type.id}}" >{{type.description}}</option>
          </select>
        </div>
        <div class="form-group">
          <label for="apr">APR </label>
          <input type="number" class="form-control" name = "APR" [(ngModel)]="newDebt.annualPercentageRate">
        </div>
        <div class="form-group">
          <label for="currentBalance">Current Balance </label>
          <input type="number" class="form-control" name = "currentBalance" [(ngModel)]="newDebt.currentBalance">
        </div>
        <div class="form-group">
          <label for="minPayment">Minimum Monthly Payment</label>
          <input type="number" class="form-control" name = "minPayment" [(ngModel)]="newDebt.minimumMonthlyPayment">
        </div>
        <div class="form-group">
          <label for="priority">Priority (Optional)</label>
          <input type="number" class="form-control" name = "priority" placeholder="1-10" [(ngModel)]="newDebt.priority">
        </div>
        <div class="row">
          <div class="btn-group" role="group" >
            <button class="btn btn-secondary" (click)="showMainOptions()">Cancel</button>
            <button class = "btn btn-primary" (click)="addDebt(newDebt, newDebtLender, newDebtType)">Add New Debt</button>
          </div>
        </div>
      </form>
    </div>
    <div *ngIf="newExpense">
      <form>
        <div class="form-row">
          <div class = "form-group">
          <label for="amount">Amount: </label>
          <input type="number" class="form-control" name="amount" [(ngModel)]="newExpense.amount" />
        </div>
        </div>
        <div class="form-group">
          <label for="description">Description: </label>
          <input type="text" class = "form-control" name="description" [(ngModel)]="newExpense.description" />
        </div>
        <div class="form-group">
          <label for="category">Category: </label>
          <select name="category" class="form-control" [(ngModel)]="newCategory.id">
            <option *ngFor="let category of categories" value="{{category.id}}">{{category.name}}</option>
          </select>
        </div>
        <div class="form-group">
          <label for="frequency">Frequency: </label>
          <select name="frequency" class ="form-control" [(ngModel)]="newFrequency.id">
            <option *ngFor="let frequency of frequencies" value="{{frequency.id}}">{{frequency.name}}</option>
          </select>
        </div>
        <div class="row">
          <div class="btn-group" role="group" >
            <button class="btn btn-secondary" (click)="showMainOptions()">Cancel</button>
            <button class="btn btn-primary" (click)="addExpense(newExpense, newCategory, newFrequency)">Add New Expense</button>
          </div>
        </div>
      </form>
    </div>
    <div *ngIf="newIncome">
      <form>
        <div class="form-row">
          <div class="form-group">
            <label for="amount">Amount: </label>
            <input type="number" class="form-control" name="amount" [(ngModel)]="newIncome.amount"/>
          </div>
          <div class="form-group">
            <label for="description">Description: </label>
            <input type="text" class="form-control" name="description" [(ngModel)]="newIncome.description" />
          </div>
          <div class="form-group">
            <label for="category">Category: </label>
            <select name="category" class="form-control" [(ngModel)]="newCategory.id">
              <option *ngFor="let category of categories" value="{{category.id}}">{{category.name}}</option>
            </select>
            </div>
          <div class="form-group">
            <label for="frequency">Frequency: </label>
            <select name="frequency" class="form-control" [(ngModel)]="newFrequency.id">
              <option *ngFor="let frequency of frequencies" value="{{frequency.id}}">{{frequency.name}}</option>
            </select>
          </div>
        <div class="row">
        <div class="btn-group" role="group" >
          <button class="btn btn-secondary" (click)="showMainOptions()">Cancel</button>
          <button class="btn btn-primary" (click)="addIncome(newIncome, newCategory, newFrequency)">Add New Income</button>
        </div>
      </div>

    </div>
    </form>
  </div>
  <div class="col-1"></div>
  <div class="col-7">
    <div style="display: block">
      <canvas baseChart
        [data]="doughnutChartData"

        [type]="doughnutChartType">
      </canvas>
    </div>
  </div>
</div>

<!-- Change password modal -->

<ng-template #passwordContent let-modal >
  <div class="modal-header">
    <h4 class="modal-title" id="modal-title">Change Password</h4>
		<button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
	</div>
	<div class="modal-body">
    <form id="modal-form">
      <div class="mb-3">
        <div class="input-group" id="modal-input-group">
          <label for="oldPassword" id="modal-content">Old Password: </label>
          <input type="password" name="oldPassword" [(ngModel)]="oldPassword" />
				</div>
        <div class="input-group" id="modal-input-group">
          <label for="newPassword1" id="modal-content">New Password: </label>
          <input type="password" name="newPassword1" [(ngModel)]="newPassword1" />
				</div>
        <div class="input-group" id="modal-input-group">
          <label for="newPassword2" id="modal-content">Retype Password: </label>
          <input type="password" name="newPassword2" [(ngModel)]="newPassword2" />
				</div>
        <div id="modal-error">{{passwordNotMatch}}</div>
			</div>
		</form>
	</div>
	<div class="modal-footer">
    <button type="button" class="btn btn-outline-dark" (click)="pwordModalSubmit(oldPassword, newPassword1, newPassword2); submittable && modal.close('Save click')">Change</button>
	</div>
</ng-template>

<!-- Update account modal -->

<ng-template #accountContent let-modal >
  <div class="modal-header">
    <h4 class="modal-title" id="modal-title">Account Info</h4>
		<button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
	</div>
	<div class="modal-body">
    <form id="modal-form">
      <div class="mb-3">
        <div class="input-group" id="modal-input-group">
          <label for="firstName" id="modal-content">First Name: </label>
          <input type="text" name="firstName" [(ngModel)]="loggedInUser.firstName" />
				</div>
        <div class="input-group" id="modal-input-group">
          <label for="lastName" id="modal-content">Last Name: </label>
          <input type="text" name="lastName" [(ngModel)]="loggedInUser.lastName" />
				</div>
        <div class="input-group" id="modal-input-group">
          <label for="email" id="modal-content">Email: </label>
          <input type="text" name="email" [(ngModel)]="loggedInUser.email" />
				</div>
			</div>
		</form>
	</div>
	<div class="modal-footer">
    <button type="button" class="btn btn-outline-dark" (click)="updateAccount(); modal.close('Save click')">Change</button>
	</div>
</ng-template>

<!-- Delete account modal -->

<ng-template #deleteContent let-modal >
  <div class="modal-header">
    <h4 class="modal-title" id="modal-title">Delete Account</h4>
		<button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
	</div>
	<div class="modal-body">
    <form id="modal-form">
      <div class="mb-3">
        <h4 id="modal-content">Are you sure you want to delete your account?</h4>
			</div>
		</form>
	</div>
	<div class="modal-footer">
    <button type="button" class="btn btn-outline-dark" (click)="disable(); modal.close('Save click')">Yes, Delete</button>
	</div>
</ng-template>
